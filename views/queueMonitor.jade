extends layout

block gcsCss
	link(rel='stylesheet', href='/stylesheets/alertify.core.css')
	link(rel='stylesheet', href='/stylesheets/alertify.default.css')
	//-link(rel='stylesheet', href='/stylesheets/gcsOmniWindow.css')

block gcsNavbarItems
	ul.nav.navbar-nav
		if(role)
			li.active
				a(href="#")
					i.fa.fa-desktop.fa-lg 
					|&nbsp;Queues
			li
				a(href="/userAdmin")
					i.fa.fa-user.fa-lg
					|&nbsp;Users
			li
				a(href="/reports")
					i.fa.fa-file-text.fa-lg 
					|&nbsp;Reports
			li
				a(href="/campaigns")
					i.fa.fa-files-o.fa-lg 
					|&nbsp;Campaigns
		else
			li
				a(href="/reportsAgents")
					i.fa.fa-archive.fa-lg 
					|&nbsp;Agents
		li
			a(href="/logout")
				i.fa.fa-power-off.fa-lg 
				|&nbsp;Logout
		li
			a(data-toggle="modal" href="#helpModal")
				i.fa.fa-question-circle.fa-lg
				|&nbsp;Help

block content
	div.modal.fade#helpModal(tabindex="-1" role="dialog" aria-labeledby="helpModalLabel" aria-hidden="true")
		div.modal-dialog
			div.modal-content
				div.modal-header
					button.close(type="button" data-dismiss="modal" aria-hidden="true")
						i.fa.fa-remove
					h4#helpModalLabel
						|GCS QueueMonitor Help
				div.modal-body
					ul
						li To Hide a full Queue Click on the Queue's top label
						li To Select an Agent Click on the agent's icon
						li To Remove an Agent from a Queue, select it and click the remove button
						li To Pause an Agent in a Queue, select it and click the pause button
						li To Monitor an Agent, select it, click the Monitor button, enter the Supervisor's extension and click "Create", a call will be sent to the Supervisor with the Agent's audio
				div.modal-footer
					button.btn.btn-default(type="button" data-dismiss="modal")
						|Close
	div.modal.fade#chanspyModal(tabindex="-1" role="dialog" aria-labeledby="chanspyModalLabel" aria-hidden="true")
		div.modal-dialog
			div.modal-content(data-bind="with: selectedAgent")
				div.modal-header
					button.close(type="button" data-dismiss="modal" aria-hidden="true")
				h4#chanspyModalLabel
					|Please enter the supervisor's extension
				div.modal-body
					div.spyAgentFormContainer
						form#spyFormMobil(data-bind="submit: spyAgent, checkStatusForSpy: status()")
							div
								label Supervisor Extension:
								input(type="text" id="spyDstMobil" name="supExtension" placeholder="Enter the Supervisor Extension")
							button.gcsBtn(type="submit") Create
							button.gcsBtn(data-dismiss="modal") Cancel
				div.modal-footer
					button.btn.btn-default(type="button" data-dismiss="modal")
						|Close

	div.row#dataContainer
		div.col-md-8.col-sm-6
			<!-- ko foreach: $data.queues -->
			<!-- ko if: "default" != id() -->
			div.queueHead(data-bind="attr: {'id': id}")
				div.queueStats
					div.queueID(data-bind="click: hideQueue, updateViewPrefs: id()")
						|Agents in Queue 
						span(data-bind="text: id")
					div.statsData(data-bind="click: detailedQueue")
						div.stat
							|Completed: 
							span.statValue(data-bind="text: completed")
						div.stat
							|Abandoned: 
							span.statValue(data-bind="text: abandonedDay")
						div.stat
							|Hold Time: 
							span.statValue(data-bind="text: holdtime")
						div.stat
							|Wait Time: 
							span.statValue(data-bind="text: waiting_calls")

					
						div.agentDrop
							ul.agentsUl.infoACDrop
								<!-- ko if: statsCalls().length < 1 -->
								li
									span.infoLabel No abandoned calls
								<!-- /ko -->
								<!-- ko ifnot: statsCalls().length < 1 -->
								<!-- ko foreach: statsCalls -->
								li
									span.infoLabel From:&nbsp
									span(data-bind="text: connectedlinename")
									span.infoLabel &nbspDate:&nbsp
									span(data-bind="text: date")
								<!-- /ko -->
								<!-- /ko -->

				<!-- ko if: agents().length < 1 -->
				div.emptyAlert(data-bind="visible: agents().length < 1")
					| Empty Queue
				<!-- /ko -->

				div.agentsContainer(data-bind='foreach: agents')
					div.agent
						div.agentTop(data-bind="click: markSelectedAgent")
							div.agentStatus
								button.btn-gcs(data-bind="visible: selected")
									i.fa.fa-arrow-right
								div.agentIcon(data-bind="statusIcon: status()")
								div.agentTopName
									span(data-bind="text: name")
								div.agentTopId
									|ext.
									span(data-bind="text: id")
									span(data-bind="visible: paused() == 1")
										| &nbsp;--> Paused
						div.agentDrop
							ul.agentsUl.infoContainerUl
								li.agentName
									i.fa.fa-user 
									span(data-bind="text: name")
								li(data-bind="visible: paused() == 1")
									i.fa.fa-pause
									|&nbsp;Paused
								li
									span.infoLabel The agent is now:&nbsp
									span(data-bind="text: statusName")
									span.infoIcon(data-bind="statusIcon: status()")
								li
									span.infoLabel And is talking to:&nbsp;
									span(data-bind="text: caller")
									span.infoIcon.fa-stack
										i.fa.fa-circle-o.fa-stack-2x
										i.fa.fa-comments-o.fa-stack-1x
								li
									span.infoLabel The last call was:&nbsp;
									span(data-bind="text: lastCall")
									span.infoIcon.fa-stack
										i.fa.fa-circle-o.fa-stack-2x
										i.fa.fa-clock-o.fa-stack-1x
								li
									span.infoLabel Has taken:&nbsp;
									span(data-bind="text: taken")
									span.infoLabel &nbsp;calls
									span.infoIcon.fa-stack
										i.fa.fa-circle-o.fa-stack-2x
										i.fa.fa-check.fa-stack-1x
								
							button.actionBtn(data-bind="click: removeAgent")
								span.fa-stack
									i.fa.fa-circle.fa-stack-2x.actionBtnBase
									i.fa.fa-remove.actionBtn.fa-stack-1x
							button.actionBtn(data-bind="click: pauseAgent")
								span.fa-stack
									i.fa.fa-circle.fa-stack-2x.actionBtnBase
									i.fa.fa-pause.actionBtn.fa-stack-1x
							button.actionBtn(data-bind="enable: isTalking(status())" data-toggle="modal" href="#chanspyModal")
								span.fa-stack
									i.fa.fa-circle.fa-stack-2x.actionBtnBase
									i.fa.fa-headphones.actionBtn.fa-stack-1x

			<!-- /ko -->
			<!-- /ko -->
		//-This info Window should only be sent to desktop and tablet users, View renderer needs to be upgraded
		div.col-md-4.col-sm-6.hidden-xs.infoContainer
			//-selectedAgent is an extended observable that will hold the selected agent information
			div(data-bind="with: selectedAgent")
				div#infoAgentData(data-bind="fadeVisible: queue")
					center
						h1
							span(data-bind="fadeVisible: queue")
								i.fa.fa-user &nbsp;
							span(data-bind="text: name")
					div.infoValidData(data-bind="fadeVisible: queue")
						center
							h4
								span.infoLabel Information for queue:&nbsp;
								span(data-bind="text: queue")
							h2
								span(data-bind="text: id")
								span(data-bind="fadeVisible: paused() == 1")
									|&nbsp;/&nbsp;Paused
							button.gcsBtn(data-bind="click: clearAgentData")
								|Dismiss
						ul.infoContainerUl
							li
								span.infoLabel The agent is now:&nbsp
								span(data-bind="text: statusName")
								span.infoIcon(data-bind="statusIcon: status()")
							li
								span.infoLabel And is talking to:&nbsp;
								span(data-bind="text: caller")
								span.infoIcon.fa.fa-stack
									i.fa.fa-circle-o.fa.fa-stack-2x
									i.fa.fa-comments-o.fa-stack-1x
							li
								span.infoLabel The last call was:&nbsp;
								span(data-bind="text: lastCall")
								span.infoIcon.fa.fa-stack
									i.fa.fa-circle-o.fa.fa-stack-2x
									i.fa.fa-clock-o.fa-stack-1x
							li
								span.infoLabel Has taken:&nbsp;
								span(data-bind="text: taken")
								span.infoLabel &nbsp;calls
								span.infoIcon.fa.fa-stack
									i.fa.fa-circle-o.fa.fa-stack-2x
									i.fa.fa-check.fa-stack-1x

				div#actionData(data-bind="fadeVisible: queue")
					center
						table#actionBtnTable
							tr
								td
									button.actionBtn(data-bind="click: removeAgent, enable: queue")
											span.fa.fa-stack
												i.fa.fa-circle.actionBtnBase.fa-stack-2x
												i.fa.fa-trash.actionBtnIcon.fa-stack-1x

								td
									button.actionBtn(data-bind="click: pauseAgent, enable: queue")
											span.fa.fa-stack
												i.fa.fa-circle.actionBtnBase.fa-stack-2x
												i.fa.fa-pause.actionBtnIcon.fa-stack-1x

								td
									button.actionBtn(data-bind="click: toggleSpyForm, enable: isTalking(status())")
											span.fa.fa-stack
												i.fa.fa-circle.actionBtnBase.fa-stack-2x
												i.fa.fa-headphones.actionBtnIcon.fa-stack-1x
							tr
								td
									|Remove
								td
									|Pause
								td
									|Monitor

					div.spyAgentFormContainer
						form#spyForm(data-bind="submit: spyAgent, checkStatusForSpy: status()")
							div
								label Supervisor Extension:
								input(type="text" id="spyDst" name="supExtension" placeholder="Enter the Supervisor Extension")
							button.gcsBtn(type="submit") Create
							button.gcsBtn(data-bind="click: toggleSpyForm") Cancel		
		
			div(data-bind="with: selectedQueue")
				div#infoQueueData
					center
						h1
							span(data-bind="fadeVisible: id != ''")
								i.fa.fa-group &nbsp;
							span(data-bind="text: id")
					div.infoValidData(data-bind="fadeVisible: id != ''")
						center
							button.gcsBtn(data-bind="click: clearQueueData")
								|Dismiss
						ul.infoAbandonedCalls
							li(style="border: none;")
								span.infoLabel Abandoned calls:&nbsp
								span(data-bind="text: abandonedDay")
							br
							
							div.abandonedCalls(data-bind='foreach: statsCalls')
								li.infoQueueLi.liLeft
									span.infoLabel From:&nbsp
									span(data-bind="text: connectedlinename")
								li.infoQueueLi.liRigth
									span.infoLabel Date:&nbsp
									span(data-bind="text: date")

block gcsScripts
	script(src="/javascripts/components/alertify.min.js")
	script(src="/javascripts/components/knockout-2.3.0.js")
	script(src="/javascripts/components/knockout.viewmodel.min.js")
	script(src="/socket.io/socket.io.js")
	//-script(src="/javascripts/jquery.omniwindow.js")
	script(src="/javascripts/app/queueMonitorClient.js")